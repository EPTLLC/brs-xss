# Project: BRS-XSS Web UI
# Company: EasyProTech LLC (www.easypro.tech)
# Dev: Brabus
# Date: Wed 25 Dec 2025 14:00:00 UTC

version: '3.8'

services:
  # Backend API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: brs-xss-backend
    ports:
      - "8000:8000"
    volumes:
      - backend_data:/app/data
      - ../brsxss:/app/brsxss:ro  # Mount scanner core
    environment:
      - DATABASE_PATH=/app/data/brsxss_ui.db
      - PYTHONPATH=/app
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Frontend (production build served by nginx)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: brs-xss-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    environment:
      - VITE_API_URL=http://localhost:8000/api
      - VITE_WS_URL=ws://localhost:8000/ws
    restart: unless-stopped

  # Blind XSS Server (optional)
  blind-xss:
    build:
      context: ../blind_xss_server
      dockerfile: Dockerfile
    container_name: brs-blind-xss
    ports:
      - "8888:8888"
    volumes:
      - blind_xss_data:/app/data
      - blind_xss_screenshots:/app/screenshots
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
    restart: unless-stopped
    profiles:
      - full  # Only start with --profile full

volumes:
  backend_data:
  blind_xss_data:
  blind_xss_screenshots:

